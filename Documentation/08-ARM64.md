# ARM64 Architecture

## Overview

ARM64 (AArch64) is the 64-bit ARM architecture used in modern mobile devices, Apple Silicon, and servers.

## Register Set

### General Purpose Registers (64-bit)
- `x0` through `x30` - General purpose registers
- `x29` (fp) - Frame pointer
- `x30` (lr) - Link register (return address)
- `sp` - Stack pointer
- `xzr` - Zero register (always 0)

### 32-bit Variants
Each 64-bit register has a 32-bit variant:
- `w0` through `w30` (lower 32 bits of x0-x30)

### Stack Simulation
- `x19` - Stack slot 0
- `x20` - Stack slot 1
- `x21` - Stack slot 2
- `x22` - Stack slot 3

## Key Features

1. **RISC architecture** - Simple, regular instruction set
2. **Fixed-width instructions** - All instructions are 4 bytes
3. **Load/store architecture** - Separate load/store and ALU ops
4. **Large register file** - 31 general-purpose registers

## Calling Convention

ARM64 uses a standard calling convention:

```asm
stp x29, x30, [sp, #-16]!  ; Save frame pointer and link register
mov x29, sp                ; Set up frame pointer
; Function body
ldp x29, x30, [sp], #16    ; Restore fp and lr
ret                        ; Return (branch to lr)
```

## Common Instructions

### Data Movement
- `mov x0, x1` - Move register to register
- `mov x0, #42` - Load immediate
- `ldr x0, [x1]` - Load from memory
- `str x0, [x1]` - Store to memory

### Arithmetic
- `add x0, x1, x2` - Add (x0 = x1 + x2)
- `sub x0, x1, x2` - Subtract
- `mul x0, x1, x2` - Multiply
- `sdiv x0, x1, x2` - Signed divide

### Logical
- `and x0, x1, x2` - Bitwise AND
- `orr x0, x1, x2` - Bitwise OR
- `eor x0, x1, x2` - Bitwise XOR

### Control Flow
- `b label` - Unconditional branch
- `b.eq label` - Branch if equal
- `b.ne label` - Branch if not equal
- `b.lt label` - Branch if less than
- `bl label` - Branch with link (call)
- `ret` - Return

## Instruction Encoding

ARM64 instructions are 32 bits with structured encoding:

### Format
```
31                           0
|  opcode  | operands | flags |
```

### Example: ADD
```
add x0, x1, x2
```
Encoding: `8B020020` (little-endian bytes: 20 00 02 8B)

### Example: RET
```
ret
```
Encoding: `D65F03C0` (little-endian bytes: C0 03 5F D6)

## Load/Store Architecture

ARM64 separates data movement from computation:

```asm
; x86-style: add eax, [ebx]
; ARM64 equivalent:
ldr x0, [x1]     ; Load from memory
add x2, x2, x0   ; Perform addition
```

## Conditional Execution

ARM64 uses condition codes and conditional branches:

```asm
cmp x0, x1       ; Compare and set flags
b.eq equal       ; Branch if equal
b.ne not_equal   ; Branch if not equal
```
